{% extends "layouts/main.html" %}

{% set journeyName = "Daily checks" %}
{% set headerCaption = data['businessUnit'] %}
{% set pageName = "Quarter and year end report" %}

{% block beforeContent %}

{{ govukBackLink({
  text: "Back",
  href: "../finance.html"
}) }}

{% endblock %}

{% block content %}

  <div class="govuk-grid-row">
    <div class="govuk-grid-column-full">

            {% if showBanner %}
              {{ mojAlert({
                variant: "success",
                dismissible: true,
                html: "Report initiated."
              }) }}
            {% endif %}

            <div class="moj-page-header-actions">
              <!-- HEADING -->
              <div class="moj-page-header-actions__title">
                <h1 class="govuk-heading-l">{{pageName}}</h1>
              </div>
              <!-- BUTTONS -->
              <div class="moj-page-header-actions__actions">
                <form method="post" action="./create-report">
                <div class="moj-button-group moj-button-group--inline">
                  <button type="submit" class="govuk-button govuk-button--primary" data-module="govuk-button">
                    Create report
                  </button>
                </div>
                </form>
              </div>
            </div>

            <form method="post" action="">
              {{ govukSelect({
                id: "business-unit",
                name: "businessUnit",
                label: {
                  text: "Filter by business unit",
                  classes: "govuk-label--s"
                },
                items: [
                  {
                    value: "all",
                    text: "All business units",
                    selected: (data['businessUnit'] == "all" or data['businessUnit'] is not defined)
                  },
                  {
                    value: "Avon and Somerset",
                    text: "Avon and Somerset",
                    selected: data['businessUnit'] == "Avon and Somerset"
                  },
                  {
                    value: "Devon and Cornwall",
                    text: "Devon and Cornwall",
                    selected: data['businessUnit'] == "Devon and Cornwall"
                  },
                  {
                    value: "Dorset",
                    text: "Dorset",
                    selected: data['businessUnit'] == "Dorset"
                  },
                  {
                    value: "Gloucestershire",
                    text: "Gloucestershire",
                    selected: data['businessUnit'] == "Gloucestershire"
                  },
                  {
                    value: "London North West",
                    text: "London North West",
                    selected: data['businessUnit'] == "London North West"
                  }
                  
                ]
              }) }}

              {% set dateRangeConditionalHtml %}
              <div class="govuk-form-group">
                <label class="govuk-label govuk-label--s" for="from-date">Enter date from</label>
                <div id="from-date-hint" class="govuk-hint">For example, 31/01/2023</div>
                {{ mojDatePicker({
                  id: "from-date",
                  name: "fromDate",
                  value: data['fromDate']
                }) }}


              </div>

              <div class="govuk-form-group">
                <label class="govuk-label govuk-label--s" for="to-date">Enter date to</label>
                <div id="to-date-hint" class="govuk-hint">For example, 31/01/2023</div>
                {{ mojDatePicker({
                  id: "to-date",
                  name: "toDate",
                  value: data['toDate']
                }) }}
              </div>
              {% endset %}

              {{ govukRadios({
                idPrefix: "date-filter",
                name: "dateFilter", 
                fieldset: {
                  legend: {
                    text: "Filter by date",
                    classes: "govuk-fieldset__legend--s"
                  }
                },
                items: [
                  {
                    value: "last-7-days",
                    text: "Last 7 days",
                    selected: data['dateFilter'] == "last-7-days"
                  },
                  {
                    value: "custom-days",
                    text: "Custom days",
                    selected: data['dateFilter'] == "custom-days"
                  },
                  {
                    value: "date-range",
                    text: "Date range",
                    selected: data['dateFilter'] == "date-range",
                    checked: "true",
                    conditional: {
                      html: dateRangeConditionalHtml
                    }
                  }
                ]
              }) }}


              <button type="submit" class="govuk-button govuk-button--secondary govuk-!-margin-bottom-4">Refresh</button>
            </form>
            

            {# Size modifiers: xl, l, m #}
            <hr class="govuk-section-break govuk-section-break--m govuk-section-break--visible">

            {% set sortedReports = reports %}

            {% if reports | length == 0 %}
              <h2 class="govuk-heading-m govuk-!-margin-top-6">No reports found</h2>
            {% else %}
              <div class="moj-scrollable-pane" >
              <table class="govuk-table" data-module="moj-sortable-table">
                  <thead class="govuk-table__head">
                  <tr class="govuk-table__row">
                      <th class="govuk-table__header" scope="col" aria-sort="descending" style="width: 20%;">Date and time</th>
                      <th class="govuk-table__header" scope="col" aria-sort="none">Title</th>
                      <th class="govuk-table__header" scope="col" aria-sort="none">Business unit</th>
                      <th class="govuk-table__header" scope="col" aria-sort="none">Created by</th>
                      <th class="govuk-table__header" scope="col" aria-sort="none">Status</th>
                      <th class="govuk-table__header empty" scope="col" aria-sort="none"></th>
                  </tr>
                  </thead>
                  <tbody class="govuk-table__body govuk-!-font-size-16">
                    {% for report in sortedReports %}
                      <tr class="govuk-table__row">
                        <td class="govuk-table__cell">
                          <a href="#" class="govuk-link govuk-link--no-visited-state" data-sort-value="{{ report.date }}">
                            {{ report.displayDate }}
                          </a>
                        </td>
                        <td class="govuk-table__cell">{{ report.title }}</td>
                        <td class="govuk-table__cell">{{ report.unit }}</td>
                        <td class="govuk-table__cell">{{ report.author }}</td>
                        <td class="govuk-table__cell">{{ report.status }}</td>
                        <td class="govuk-table__cell download">
                          <a href="#" class="govuk-link govuk-link--no-visited-state" download>Download</a>
                        </td>
                      </tr>
                    {% endfor %}
                  </tbody>
              </table>
              </div>
            {% endif %}

    </div>
  </div>

   <style>

    .govuk-table__header.empty button {
        display: none;
        text-align: right;
    }

    .govuk-table__cell.download {
        text-align: right;
    }

  </style>

{% endblock %}


